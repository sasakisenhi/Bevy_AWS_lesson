# game_runtime Instructions

本ドキュメントは、`game_runtime` クレートにおける  
**実装上の指針と責務の境界**を定義する。

本クレートは、`copilot-instructions.md`、`architecture.md`、  
および `game_logic.instructions.md` を前提とする。

---

## game_runtime の目的

`game_runtime` は、  
`game_logic` に定義された振る舞いを、  
**実行環境（Bevy）上で動かすための層**である。

- 入力・描画・時間・リソース管理
- Bevy ECS との接続
- 実行ループの構成
- プラグイン・システムの構築
- ロジック実行のための環境設定

を主な責務とする。

---

## 許可される依存関係

- Bevy および Bevy ECS
- 入力デバイス・描画・ウィンドウ・時間管理
- OS・プラットフォーム依存機能（必要な範囲）
- `game_logic` / `game_core`
- テスト専用クレート（`#[cfg(test)]` 下）
- ログ・エラーハンドリング系クレート
- Bevy Resource は、
  runtime における接続・設定・共有状態に限定して使用する


---

## 禁止・制限される実装（最重要）

以下は **原則として禁止**、または強く制限する。

- ゲームルールの本質的判断を直接書くこと
- 状態遷移の意味を runtime 側で定義すること
- `game_core` のデータを破壊的に操作すること
- 同一ロジックの重複実装
- 乱数の直接使用
- グローバル状態・シングルトン的構造の使用

これらは **`game_logic` / `game_core` の責務**である。

---

## 実装スタイルの指針

- runtime は「接続」と「委譲」を主とする
- System は薄く保ち、ロジックを溜め込まない
- ECS の Entity / Component は、
  logic の状態を表現するための器として扱う
- Plugin 単位で責務を閉じることを優先する
- ロジックを logic に移せる場合は移す
- 可能な限り副作用を局所化する
- 所有権・借用ルールを尊重する

---

## logic / core との接続姿勢

- runtime は、logic を **呼び出す側**であり、
  logic の意味を再解釈しない
- core の型・ルールは、
  runtime で再定義・拡張しない
- データの変換・抽出・反映は、
  runtime の責務として明示的に行う
- logic / core の API を
  そのまま呼び出す形を優先する
- logic / core の変更に伴う
  runtime 側の修正は最小限に留める

---

## 迷ったときの判断基準

次の問いに YES と答えられるかを確認する。

- 「これは実行環境との接続か？」
- 「この処理は Bevy がなければ成立しないか？」
- 「ロジックを logic に移せないか？」

NO が含まれる場合、  
その実装は `game_runtime` に置くべきではない可能性がある。
