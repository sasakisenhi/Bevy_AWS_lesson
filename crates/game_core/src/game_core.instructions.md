# game_core Instructions

本ドキュメントは、`game_core` クレートにおける  
**実装上の具体的な指針と禁止事項**を定義する。

本クレートは、`copilot-instructions.md` および  
`architecture.md` に定義された方針を前提とする。

---

## game_core の目的

`game_core` は、  
ゲームの**本質的な概念・ルール・データ構造**を表現するための層である。

- 実行環境から独立していること
- 外部ライブラリ（Bevy）に依存しないこと
- 単体でテスト可能であること
- 副作用を持たないこと

を最優先とする。

---

## 許可される依存関係

- Rust 標準ライブラリ
- 純粋な数値計算・データ構造系クレート（必要最小限）
- テスト専用クレート（`#[cfg(test)]` 下）

---

## 禁止される依存関係（最重要）

以下への依存は禁止する。

- Bevy および ECS 関連
- 時間・入力・描画・OS 依存機能
- グローバル状態・シングルトン的構造
- 乱数の直接使用  
-（必要な場合は、外部から注入された値を用いる）

Copilot は、  
これらを **便利だからという理由で導入してはならない。**

---

## 実装スタイルの指針

- 構造体・型・関数は「概念」を表す名前を用いる
- メソッドは副作用を持たないことを原則とする
- 状態遷移は、明示的な入力と出力で表現する
- 可変性は最小限に留める
- 所有権・借用ルールを尊重する

---

## テスト・ドキュメントについて

- `pub` な API には rustdoc を原則付与する
- `# Examples` は仕様・契約の固定点として扱う
- 単体テストでは、境界条件・代表的ケースを重視する
- テスト不能な設計は、設計上の問題として扱う
- テストコードもコードスタイル指針に従う
- `cargo test` が常に成功する状態を保つ

---

## 迷ったときの判断基準

次の問いに YES と答えられない場合、  
その実装は `game_core` に置くべきではない可能性が高い。

- 「これはゲームの本質的な概念か？」
- 「Bevy がなくても意味を持つか？」
- 「単体テストとして検証できるか？」
- ※ 本クレートに新しい依存を追加する場合は、
「game_core の目的」に照らして妥当性を確認すること。
- ※ 実装スタイルに迷った場合は、他の部分と一貫性があるか確認すること。