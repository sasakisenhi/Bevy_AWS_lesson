# Refactor Prompt

このプロンプトは、既存コードに対して  
**設計制約を守りながらリファクタリングを検討する**ためのものです。

実装をいきなり変更せず、  
まず「判断」と「理由」を明確にしてください。

---

## 前提

- copilot-instructions.md
- architecture.md
- design.md
- README.md
- CONTRIBUTING.md
- 各 `*.instructions.md`
- Default Agent

上記ドキュメントに定義された  
設計思想・責務分離・禁止事項を必ず尊重してください。

---

## 手順

次の順序で作業してください。

### 1. 現状理解

- このコードの責務は何か
- どのレイヤー（core / logic / runtime）に属するか
- 依存関係は適切か
- 主要なデータ構造・関数・型の役割
- 副作用・可変性の扱い

を言語化してください。

---

### 2. 問題点の洗い出し

※ 該当レイヤーの `*.instructions.md` に照らして問題を評価すること。

以下の観点で、**問題になりうる点**を列挙してください。

- 責務が曖昧になっていないか
- レイヤー境界を越えていないか
- テストしにくい構造になっていないか
- 名前が意図を正しく表しているか
- 不要な可変性・副作用がないか
- 依存関係が適切か
- 冗長・複雑になっていないか
- パフォーマンス上の懸念はないか

※ 問題がない場合は「問題ない理由」を説明してください。

---

### 3. 改善案の検討（複数案）

- 最小変更で改善する案
- 構造を少し整理する案

をそれぞれ提示し、  
**利点・欠点・影響範囲**を説明してください。

---

### 4. 実装可否の判断

- この変更は「実装変更」か「設計変更」か
- 設計変更に該当する場合は、実装せず提案に留める

を明示してください。

---

### 5. 実装（必要な場合のみ）

実装を行う場合は、

- 差分を最小にする
- 既存 API の意味を変えない
- テストがあれば更新する
- ドキュメントを更新する

ことを守ってください。

---

## 出力の期待

- なぜその変更が必要なのかが説明されていること
- 「やらなかったこと」も理由付きで言語化されていること
- 過剰な最適化を行っていないこと
- 既存コードベースとの一貫性が保たれていること
- 変更履歴が明確であること
