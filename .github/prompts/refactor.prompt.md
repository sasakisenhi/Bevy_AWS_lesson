---
name: refactorPrompt
description: 設計制約を尊重しながらリファクタリングを判断・検討する
argument-hint: 対象となるコード、ファイル、またはモジュール
---

このプロンプトは、既存コードに対して  
**設計制約・責務分離・変更境界を尊重しながら**  
リファクタリングを検討するためのものです。

実装をいきなり変更せず、  
まず「判断」と「理由」を明確にしてください。

---

## 前提

この作業では、対象のコードベースに存在する以下を前提とします。

- アーキテクチャやレイヤー分離の方針
- 設計上の制約・禁止事項
- 既存のコーディング規約やドキュメント

これらと矛盾する変更は、  
**設計変更の可能性がある**ものとして扱ってください。

---

## 手順

次の順序で作業してください。

### 1. 現状理解

対象コードについて、以下を言語化してください。

- このコードの責務は何か
- どのレイヤー・役割に属するか
- 依存関係は適切か
- 主要なデータ構造・関数・型の役割
- 副作用や可変性の扱い

---

### 2. 問題点の洗い出し

以下の観点から、**問題になりうる点**を列挙してください。

- 責務が曖昧になっていないか
- レイヤーや責務の境界を越えていないか
- テストしにくい構造になっていないか
- 名前が意図を正しく表しているか
- 不要な可変性・副作用がないか
- 依存関係が過剰または不適切でないか
- 冗長・過度に複雑になっていないか
- パフォーマンス上の懸念はあるか

※ 問題がない場合は、  
「なぜ問題ないと言えるか」を説明してください。

---

### 3. 改善案の検討（複数案）

以下の2種類の案を検討してください。

- **最小変更で改善する案**
- **構造を整理する案**

それぞれについて、

- 利点
- 欠点
- 影響範囲

を説明してください。

---

### 4. 実装可否の判断

検討した変更について、

- これは「実装変更」か「設計変更」か
- 設計変更に該当する場合は、実装せず提案に留めるべきか

を明示してください。

---

### 5. 実装（必要な場合のみ）

実装を行う場合は、以下を必ず守ってください。

- 差分を最小限に保つ
- 既存 API や挙動の意味を変えない
- 既存のテストがあれば更新・追加する
- 必要に応じてドキュメントを更新する

---

## 出力の期待

- なぜその変更が必要（または不要）なのかが説明されていること
- 「やらなかったこと」も理由付きで言語化されていること
- 過剰な最適化や不要な抽象化を行っていないこと
- 既存コードベースとの一貫性が保たれていること
- 変更履歴や判断の痕跡が追えること
